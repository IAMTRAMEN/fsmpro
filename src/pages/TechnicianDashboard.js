import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useFSMStore } from '../store/useFSMStore';
import { GPSTracker } from '../components/GPSTracker';
import { MapPin, Clock, CheckCircle, Navigation, Calendar as CalendarIcon, ChevronRight } from 'lucide-react';
const TechnicianDashboard = () => {
    const { currentUser, workOrders, updateWorkOrderStatus, updateTechnicianStatus } = useFSMStore();
    const technician = currentUser; // Technician type
    // Filter jobs for this technician
    const myJobs = workOrders.filter(wo => wo.technicianIds.includes(currentUser?.id || ''));
    const currentJob = myJobs.find(wo => wo.status === 'In Progress');
    const upcomingJobs = myJobs.filter(wo => wo.status === 'Assigned').sort((a, b) => new Date(a.scheduledStart).getTime() - new Date(b.scheduledStart).getTime());
    const handleStatusChange = (id, newStatus) => {
        updateWorkOrderStatus(id, newStatus);
        if (newStatus === 'In Progress' && currentUser?.id) {
            updateTechnicianStatus(currentUser.id, 'Busy');
        }
        else if (newStatus === 'Completed' && currentUser?.id) {
            updateTechnicianStatus(currentUser.id, 'Available');
        }
    };
    const handleNavigate = () => {
        if (currentJob && currentJob.location) {
            const { lat, lng } = currentJob.location;
            window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
        }
    };
    return (_jsxs("div", { className: "space-y-6 max-w-lg mx-auto", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-2xl font-bold text-gray-900 dark:text-gray-100", children: "My Day" }), _jsx("p", { className: "text-gray-500 dark:text-gray-400", children: new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }) })] }), _jsx("div", { className: `px-3 py-1 rounded-full text-sm font-medium ${technician?.status === 'Busy' ? 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300' :
                            technician?.status === 'Available' ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' :
                                'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200'}`, children: technician?.status || 'Available' })] }), currentUser && (_jsx(GPSTracker, { technicianId: currentUser.id, enabled: true })), currentJob ? (_jsxs("div", { className: "bg-blue-600 rounded-2xl p-6 text-white shadow-lg shadow-blue-200", children: [_jsxs("div", { className: "flex justify-between items-start mb-4", children: [_jsx("span", { className: "bg-blue-500 bg-opacity-50 px-3 py-1 rounded-full text-xs font-medium border border-blue-400", children: "In Progress" }), _jsxs("span", { className: "text-blue-100 text-sm font-mono", children: ["#", currentJob.id] })] }), _jsx("h2", { className: "text-xl font-bold mb-2", children: currentJob.title }), _jsx("p", { className: "text-blue-100 mb-6 line-clamp-2", children: currentJob.description }), _jsxs("div", { className: "space-y-3 mb-6", children: [_jsxs("div", { className: "flex items-center gap-3 text-blue-50", children: [_jsx(MapPin, { className: "w-5 h-5" }), _jsx("span", { className: "text-sm", children: currentJob.location.address })] }), _jsxs("div", { className: "flex items-center gap-3 text-blue-50", children: [_jsx(Clock, { className: "w-5 h-5" }), _jsxs("span", { className: "text-sm", children: ["Started at ", new Date(currentJob.scheduledStart).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })] })] })] }), _jsxs("div", { className: "grid grid-cols-2 gap-3", children: [_jsxs("button", { onClick: handleNavigate, className: "bg-white text-blue-600 py-2.5 rounded-lg font-semibold text-sm flex items-center justify-center gap-2 hover:bg-blue-50 transition-colors", children: [_jsx(Navigation, { className: "w-4 h-4" }), " Navigate"] }), _jsxs("button", { onClick: () => handleStatusChange(currentJob.id, 'Completed'), className: "bg-green-500 text-white py-2.5 rounded-lg font-semibold text-sm flex items-center justify-center gap-2 hover:bg-green-600 transition-colors", children: [_jsx(CheckCircle, { className: "w-4 h-4" }), " Complete"] })] })] })) : (_jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-2xl p-8 text-center border border-dashed border-gray-300 dark:border-gray-600", children: [_jsx("div", { className: "w-16 h-16 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4", children: _jsx(Clock, { className: "w-8 h-8 text-gray-400 dark:text-gray-500" }) }), _jsx("h3", { className: "text-lg font-medium text-gray-900 dark:text-gray-100", children: "No Active Job" }), _jsx("p", { className: "text-gray-500 dark:text-gray-400 text-sm mt-1", children: "Pick a job from your schedule to start." })] })), _jsxs("div", { children: [_jsxs("h3", { className: "font-bold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2", children: [_jsx(CalendarIcon, { className: "w-5 h-5 text-gray-500 dark:text-gray-400" }), "Upcoming Jobs (", upcomingJobs.length, ")"] }), _jsx("div", { className: "space-y-3", children: upcomingJobs.map((job) => (_jsxs("div", { className: "bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-100 dark:border-gray-700 shadow-sm hover:shadow-md dark:hover:shadow-gray-900/20 transition-shadow", children: [_jsxs("div", { className: "flex justify-between items-start mb-2", children: [_jsxs("div", { children: [_jsx("h4", { className: "font-semibold text-gray-900 dark:text-gray-100", children: job.title }), _jsx("p", { className: "text-xs text-gray-500 dark:text-gray-400", children: job.serviceType })] }), _jsx("span", { className: `px-2 py-1 rounded text-xs font-medium ${job.priority === 'Critical'
                                                ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300'
                                                : 'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300'}`, children: job.priority })] }), _jsxs("div", { className: "flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 mb-3", children: [_jsx(MapPin, { className: "w-4 h-4 text-gray-400 dark:text-gray-500" }), _jsx("span", { className: "truncate", children: job.location.address })] }), _jsxs("div", { className: "flex items-center justify-between pt-3 border-t border-gray-50 dark:border-gray-700", children: [_jsx("span", { className: "text-xs font-medium text-gray-500 dark:text-gray-400", children: new Date(job.scheduledStart).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }), _jsxs("button", { onClick: () => handleStatusChange(job.id, 'In Progress'), className: "text-blue-600 dark:text-blue-400 text-sm font-medium flex items-center gap-1 hover:text-blue-700 dark:hover:text-blue-300", children: ["Start Job ", _jsx(ChevronRight, { className: "w-4 h-4" })] })] })] }, job.id))) })] })] }));
};
export default TechnicianDashboard;
